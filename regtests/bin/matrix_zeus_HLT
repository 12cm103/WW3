#!/bin/sh
# --------------------------------------------------------------------------- #
# matrix.go: Run matrix of regression tests on target machine.                #
#                                                                             #
# Remarks:                                                                    #
# - This version is set up for a global .wwatch3.env file and for the         #
#   NOAA RDHPC 'zeus' system. When using this for your own setup and          #
#   computer, please copy rather than modify.                                 #
# - Needs to be executed from regtests directory.                             #
# - I like to link the version I need locally to matrix.go in the retests     #
#   directory (links, not svn version), but that is just my taste ...         #
#                                                                             #
#                                                      Hendrik L. Tolman      #
#                                                      August 2013            #
#                                                                             #
#    Copyright 2013 National Weather Service (NWS),                           #
#       National Oceanic and Atmospheric Administration.  All rights          #
#       reserved.  WAVEWATCH III is a trademark of the NWS.                   #
#       No unauthorized use without permission.                               #
#                                                                             #
# --------------------------------------------------------------------------- #
# 1. Set up
# 1.a Computer/ user dependent set up

  echo '#!/bin/sh'                                           > matrix.head
  echo ' '                                                  >> matrix.head
  echo '#PBS -l procs=12'                                   >> matrix.head
  echo '#PBS -q urgent'                                     >> matrix.head
  echo '#PBS -l walltime=08:00:00'                          >> matrix.head
  echo '#PBS -A omd'                                        >> matrix.head
  echo '#PBS -N ww3_regtest'                                >> matrix.head
  echo '#PBS -j oe'                                         >> matrix.head
  echo '#PBS -o matrix_b.out'                               >> matrix.head
  echo ' '                                                  >> matrix.head

  export home_dir=`pwd`
  echo "  cd $home_dir"                                     >> matrix.head
  echo ' '                                                  >> matrix.head

# Compiler option. Choose appropriate compiler and set cmplOption to
# y if using for the first time or using a different compiler

  cmplr=Intel
  export cmplOption='-'

  export  mpi='mpiexec_mpt'
  export   np='12'

  if [ "$cmplOption" = 'y' ]
  then
     export rtst="./bin/run_test -c $cmplr -a ~/.wwatch3.env -G"
  else
     export rtst="./bin/run_test -a ~/.wwatch3.env -G"
  fi

  export  ww3='../.'

# 1.b Flags to do course selection - - - - - - - - - - - - - - - - - - - - - -
#     Addition selection by commenting out lines as below

  export testtest='y' # Run a single case of each test only

  export     shrd='y' # Do shared architecture tests
  export     dist='y' # Do distributed architecture tests
  export      omp='X' # NEED TO IMPLEMENT STILL ....

  export   prop1D='n' # 1-D propagation tests (ww3_tp1.X)
  export   prop2D='n' # 2-D propagation tests (ww3_tp2.X)
  export     time='n' # time linmited growth
  export    fetch='n' # fetch linmited growth
  export    shwtr='n' # shallow water tests
  export    unstr='n' # unstructured grid tests
  export    smcgr='n' # SMC/Rotated grid test
  export   hur1mg='n' # Hurricane with one moving grid
  export  multi01='y' # mww3_test_01 (wetting and drying)
  export  multi02='y' # mww3_test_02 (basic two-way nesting test))
  export  multi03='y' # mww3_test_03 (three high and three low res grids).
  export  multi04='y' # mww3_test_04 (swell on sea mount and/or current)
  export  multi05='y' # mww3_test_05 (three-grid moving hurricane)
  export  multi06='y' # mww3_test_06 (curvilinear grid tests)

# export   filter='PR1'
                      # The filter does a set of consecutinve greps on the 
                      # command lines generated by filter.base with the above
                      # selected options.

# --------------------------------------------------------------------------- #
# 2.  Ecxecute matrix.base ...                                                #
# --------------------------------------------------------------------------- #

  ./bin/matrix.base

# --------------------------------------------------------------------------- #
# End to the matrix                                                           #
# --------------------------------------------------------------------------- #
